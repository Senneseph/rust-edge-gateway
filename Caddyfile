# Rust Edge Gateway Caddy Configuration
# Automatic HTTPS with Let's Encrypt

{$TARGET_DOMAIN} {
    # Admin UI
    handle /admin/* {
        reverse_proxy rust-edge-gateway:8081
    }
    
    # API endpoints for admin
    handle /api/* {
        reverse_proxy rust-edge-gateway:8081
    }
    
    # Documentation (served from docs container or static files)
    handle /docs/* {
        reverse_proxy docs:3000
    }
    
    # All other requests go to the gateway
    handle {
        reverse_proxy rust-edge-gateway:8080
    }
    
    # Security headers and HTTPS
    tls admin@iffuso.com
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Content-Security-Policy "default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'"
    }
    
    # Logging
    log {
        output stdout
        format console
    }
}

# Wildcard for handler domains
*.{$TARGET_DOMAIN} {
    reverse_proxy rust-edge-gateway:8080
    
    log {
        output stdout
        format console
    }
}

